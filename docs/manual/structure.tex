%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Modern Software Documentation Style
% Custom design for cuRAMSES-kjhan
% tcolorbox-based environments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	REQUIRED PACKAGES
%----------------------------------------------------------------------------------------

\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{calc}

\usepackage{enumitem}
\setlist{nolistsep}

\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash}p{#1}}

\usepackage{amsmath,amsfonts,amssymb,amsthm}
\usepackage{etoolbox}

\usepackage{makeidx}
\makeindex

%----------------------------------------------------------------------------------------
%	ADDITIONAL COLORS
%----------------------------------------------------------------------------------------

\colorlet{darkocre}{ocre!70!black}
\definecolor{codebg}{RGB}{245,247,250}
\definecolor{codeframe}{RGB}{200,210,220}
\definecolor{darkblue}{RGB}{0,51,102}
\definecolor{successgreen}{RGB}{39,174,96}
\definecolor{dangered}{RGB}{192,57,43}

%----------------------------------------------------------------------------------------
%	CODE LISTINGS
%----------------------------------------------------------------------------------------

\usepackage{listings}
\lstset{
    basicstyle=\ttfamily\small,
    backgroundcolor=\color{codebg},
    frame=single,
    rulecolor=\color{codeframe},
    breaklines=true,
    numbers=left,
    numberstyle=\tiny\color{gray},
    keywordstyle=\color{darkocre}\bfseries,
    commentstyle=\color{successgreen!70!black}\itshape,
    stringstyle=\color{dangered},
    showstringspaces=false,
    tabsize=4,
    xleftmargin=2em,
    framexleftmargin=1.5em,
    aboveskip=1em,
    belowskip=1em
}

\lstdefinestyle{fortran}{
    language=[95]Fortran,
    morekeywords={integer,real,logical,character,allocatable,intent,
    dimension,implicit,none,use,module,contains,subroutine,function,
    end,call,if,then,else,endif,do,enddo,return,include,kind,dp,i8b,
    save,present,optional,select,case,type,class}
}

\lstdefinestyle{bash}{
    language=bash,
    morekeywords={make,mpirun,cd,cp,nohup,export}
}

%----------------------------------------------------------------------------------------
%	PAGE HEADERS
%----------------------------------------------------------------------------------------

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\sffamily\normalsize\thepage}
\fancyhead[LO]{\sffamily\small\nouppercase{\rightmark}}
\fancyhead[RE]{\sffamily\small\nouppercase{\leftmark}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\headrule}{\hbox to\headwidth{%
    \color{ocre!50}\leaders\hrule height \headrulewidth\hfill}}
\renewcommand{\footrulewidth}{0pt}
\fancypagestyle{plain}{\fancyhead{}\renewcommand{\headrulewidth}{0pt}}

%----------------------------------------------------------------------------------------
%	CHAPTER AND SECTION HEADINGS
%----------------------------------------------------------------------------------------

\usepackage[explicit]{titlesec}

% Chapter: large number + colored rule
\titleformat{\chapter}[display]
    {\normalfont\sffamily\bfseries}
    {\flushright\fontsize{80}{90}\selectfont\color{ocre!20}\thechapter}
    {-1.5cm}
    {\flushright\color{darkocre}\Huge#1}
    [\vspace{0.3em}{\color{ocre}\titlerule[2pt]}]

\titleformat{name=\chapter,numberless}[display]
    {\normalfont\sffamily\bfseries}
    {}
    {-0.5cm}
    {\color{darkocre}\Huge#1}
    [\vspace{0.3em}{\color{ocre}\titlerule[2pt]}]

\titlespacing*{\chapter}{0pt}{-20pt}{30pt}

% Section
\titleformat{\section}
    {\normalfont\Large\bfseries\sffamily\color{darkocre}}
    {\color{ocre}\thesection}{0.5em}{#1}

% Subsection
\titleformat{\subsection}
    {\normalfont\large\bfseries\sffamily}
    {\color{ocre}\thesubsection}{0.5em}{#1}

% Subsubsection
\titleformat{\subsubsection}
    {\normalfont\normalsize\bfseries\sffamily}
    {\color{ocre}\thesubsubsection}{0.5em}{#1}

% Part
\titleformat{\part}[display]
    {\centering\normalfont\huge\bfseries\sffamily\color{darkocre}}
    {\fontsize{80}{90}\selectfont\color{ocre!20}\thepart}
    {1em}
    {\Huge#1}
    [\vspace{0.5em}{\color{ocre}\titlerule[3pt]}]

%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS
%----------------------------------------------------------------------------------------

\usepackage{titletoc}
\contentsmargin{0cm}

\titlecontents{part}[0cm]
    {\addvspace{20pt}\centering\large\bfseries\sffamily}
    {\color{ocre}\thecontentslabel\quad}
    {}
    {}

\titlecontents{chapter}[1.25cm]
    {\addvspace{12pt}\large\sffamily\bfseries}
    {\color{ocre}\contentslabel[\Large\thecontentslabel]{1.25cm}\color{darkocre}}
    {\color{darkocre}}
    {\color{ocre}\normalsize\;\titlerule*[.5pc]{.}\;\thecontentspage}

\titlecontents{section}[1.25cm]
    {\addvspace{3pt}\sffamily\bfseries}
    {\contentslabel[\thecontentslabel]{1.25cm}}
    {}
    {~\titlerule*[.5pc]{.}~\thecontentspage}

\titlecontents{subsection}[1.25cm]
    {\addvspace{1pt}\sffamily\small}
    {\contentslabel[\thecontentslabel]{1.25cm}}
    {}
    {~\titlerule*[.5pc]{.}~\thecontentspage}

%----------------------------------------------------------------------------------------
%	COLORED ENVIRONMENTS (tcolorbox)
%----------------------------------------------------------------------------------------

\usepackage[most]{tcolorbox}
\tcbuselibrary{skins,breakable}

% Definition
\newtcolorbox[auto counter,number within=chapter]{definition}[1][]{%
    enhanced,breakable,
    colback=ocre!5,
    colframe=ocre,
    coltitle=white,
    fonttitle=\bfseries\sffamily,
    title=Definition~\thetcbcounter\ifstrempty{#1}{}{~(#1)},
    attach boxed title to top left={yshift=-2mm,xshift=5mm},
    boxed title style={colback=ocre,sharp corners,boxrule=0pt},
    sharp corners,
    boxrule=0.5pt,
    left=5pt,right=5pt,top=8pt,bottom=5pt
}

% Theorem
\newtcolorbox[auto counter,number within=chapter]{theorem}[1][]{%
    enhanced,breakable,
    colback=darkblue!5,
    colframe=darkblue!80,
    coltitle=white,
    fonttitle=\bfseries\sffamily,
    title=Theorem~\thetcbcounter\ifstrempty{#1}{}{~(#1)},
    attach boxed title to top left={yshift=-2mm,xshift=5mm},
    boxed title style={colback=darkblue!80,sharp corners,boxrule=0pt},
    sharp corners,
    boxrule=0.5pt,
    left=5pt,right=5pt,top=8pt,bottom=5pt
}

% Example
\newtcolorbox[auto counter,number within=chapter]{example}[1][]{%
    enhanced,breakable,
    colback=successgreen!5,
    colframe=successgreen!70!black,
    coltitle=white,
    fonttitle=\bfseries\sffamily,
    title=Example~\thetcbcounter\ifstrempty{#1}{}{~(#1)},
    attach boxed title to top left={yshift=-2mm,xshift=5mm},
    boxed title style={colback=successgreen!70!black,sharp corners,boxrule=0pt},
    sharp corners,
    boxrule=0.5pt,
    left=5pt,right=5pt,top=8pt,bottom=5pt
}

% Remark (left-ruled, blue)
\newtcolorbox{remark}[1][Remark]{%
    enhanced,breakable,
    colback=darkblue!3,
    colframe=darkblue,
    coltitle=darkblue,
    fonttitle=\bfseries\sffamily,
    title=#1,
    boxrule=0pt,
    leftrule=4pt,
    sharp corners,
    left=5pt,right=5pt,top=5pt,bottom=5pt
}

% Info box (left-ruled, teal)
\newtcolorbox{infobox}[1][Info]{%
    enhanced,breakable,
    colback=ocre!5,
    colframe=ocre,
    coltitle=darkocre,
    fonttitle=\bfseries\sffamily,
    title=#1,
    boxrule=0pt,
    leftrule=4pt,
    sharp corners,
    left=5pt,right=5pt,top=5pt,bottom=5pt
}

% Important (left-ruled, red)
\newtcolorbox{important}{%
    enhanced,breakable,
    colback=dangered!5,
    colframe=dangered,
    coltitle=dangered!90!black,
    fonttitle=\bfseries\sffamily,
    title=Important,
    boxrule=0pt,
    leftrule=4pt,
    sharp corners,
    left=5pt,right=5pt,top=5pt,bottom=5pt
}

% Code box (simple wrapper â€” compatible with lstlisting inside)
\newenvironment{codebox}[1][]{%
    \par\medskip
    \ifstrempty{#1}{}{{\noindent\sffamily\small\bfseries\color{darkocre}#1}\par\nobreak\vspace{-0.8em}}%
}{%
    \par\medskip
}

%----------------------------------------------------------------------------------------
%	HYPERLINKS
%----------------------------------------------------------------------------------------

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=darkocre,
    citecolor=darkblue,
    urlcolor=ocre,
    bookmarks=true,
    bookmarksopen=false
}
